const fs = require('fs');
const path = require('path');
const clearingHouseData = require('../../../protocol/sdk/src/idl/drift.json');

let uiErrors = {
	errorsList: {},
};

try {
	uiErrors = require('./src/constants/autogenerated/driftErrors.json');
} catch (e) {
	console.log("ui errors file doesn't exist yet");
}

// errorCodesMap should get reset every time, because the numbers could potentially change in the protocol's output
// UI will use this to map the error code (number) to the name, so we can keep our manually added messages identified by the name but independent of the number
uiErrors.errorCodesMap = {};

clearingHouseData.errors.forEach((err) => {
	uiErrors.errorCodesMap[err.code] = err.name;
	if (!uiErrors.errorsList[err.name]) {
		uiErrors.errorsList[err.name] = err;
	} else {
		// Only update error code in errorsList
		uiErrors.errorsList[err.name].code = err.code;
	}
});

const copyErrorCodes = () => {
	fs.writeFileSync(
		path.join(__dirname, 'src', 'constants', 'driftErrors.json'),
		`${JSON.stringify(uiErrors, null, '	')}\n`
	);
};

module.exports = copyErrorCodes;
